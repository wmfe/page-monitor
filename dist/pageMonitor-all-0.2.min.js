~function(e){function t(e){var t=/(chrome)\/(\d+\.\d)/,r=/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/,n=/(opera)(?:.*version)?[ \/]([\w.]+)/,o=/(msie) ([\w.]+)/,a=/(mozilla)(?:.*? rv:([\w.]+))?/;e=e.toLowerCase();var i=t.exec(e)||n.exec(e)||o.exec(e)||e.indexOf("compatible")<0&&a.exec(e)||[];return r.exec(e)&&!/chrome/.test(e)&&(i[1]="safari",i[2]=RegExp.$1||RegExp.$2),{browser:i[1]||"unknown",version:i[2]||"0"}}function r(){for(var e=document.body.childNodes,t="",r=e.length-1;r>=0;r--)if(e[r].nodeType==document.COMMENT_NODE){t=e[r].textContent;break}return t}function n(e){var t=!1;return Array.isArray(e)?(e.some(function(e,r){e.test(c.href)&&(t=!0)}),e.length?null:t=!0):t=e==c.href,t}function o(e,t){var r={};for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);for(var o in t)t.hasOwnProperty(o)&&(r[o]=t[o]);return r}function a(){var e=d.q;if(!e)return{};for(var t={},r=0;r<e.length;r++)t[e[r][0]]=e[r][1];return t}var i=e.navigator,c=e.location,u=e.screen,s=e.document,d=e.BDWMMonitor||{};d.url="//log.waimai.baidu.com/static/exceptionjs.gif?",d.beforeReport=function(e,t){return t};var p=a();d.init=function(){var e=p.module,o=p.conf;d._conf={platform:o.platform,app:o.app,channel:o.channel,pageid:o.pageid||0,traceCode:""},o.url?d.url=o.url:null,o.beforeReport?d.beforeReport=o.beforeReport:null,n(o.pageWhiteList)&&e.forEach(function(e,t){d.use(e)});var a=function(){d._conf.traceCode=r()};window.addEventListener("DOMContentLoaded",function(){a(),window.removeEventListener("DOMContentLoaded",a)});var c=t(i.userAgent),s=u.width+"*"+u.height+"|"+u.availWidth+"*"+u.availHeight;"pc"===o.channel&&(d._conf.browser=c.browser+"|"+c.version),d._conf._screen=s},d._module={},d.define=function(e,t){if(d._module[e])throw new Error(e+" Already defined");d._module[e]=t()},d.report=function(e,t){if(d.url&&e&&t){if(t=d.beforeReport(e,t),!t)throw new Error("Report data is empty");var r=d._conf;if(!r.app||!r.channel||!r.platform)throw new Error("Global report data fragmentary");t=o(r,t);var n=s.createElement("img"),a=d.url,i=[];for(var c in t)i.push(c+"="+encodeURIComponent(t[c]));var u="img_"+ +new Date;d[u]=n,n.onload=n.onerror=function(){d[u]=n=n.onload=n.onerror=null,delete d[u]},n.src=a+(a.indexOf("?")<0?"?":"&")+i.join("&")}},d.error=function(e){d.report("exception",e)},d.use=function(e){d._module[e]?d._module[e].run():p[e]&&(d._module[e]=p[e]())&&d._module[e].run()},d.init()}(window),function(e){var t=e.BDWMMonitor,r=e.location,n=e.performance||e.webkitPerformance||e.msPerformance||e.mozPerformance;t("net",function(){var a=["script","link","xmlhttprequest"],i=["resource","measure"],c=500;return{run:function(){this.resourceHook(),this.initXhrHook()},resourceHook:function(){window.addEventListener("error",function(e){var n=e.srcElement||e.target;if(n instanceof HTMLElement){var o=n.tagName.toLowerCase();/script|link|img/.test(o)&&t.report("exception",{tag:"resource_error",url:n.src||n.href,purl:r.href,err_status:"404",err_msg:"Not Found"})}},!0),this.initPerfObserve(),this.resourceLoadAdapter(!0),this.resourceLoadAdapter(!1)},resourceLoadAdapter:function(t){var r=function(){},n=function(){},o="_resourceLoadSucc",a="_resourceLoadFail",i=t?o:a,c=t?r:n;if(e[i]){var u=e[i];e[i]=function(e){u(e),c(e)}}else e[i]=c},initjQueryObserve:function(){var e=this;(window.jQuery||window.Zepto)&&$(document).ajaxComplete(function(t,r,n){var o=e.getLastEntryByUrl(n.url);o&&e.analyzePerfEntry(o)})},analyzePerfEntry:function(e){var r=e.duration;r>c&&t.report("resource",{tag:"resource_timing",p_lookup:e.domainLookupEnd-e.domainLookupStart,p_tcp:e.connectEnd-e.connectStart,p_ssl:e.secureConnectionStart>0?e.connectEnd-e.secureConnectionStart:0,p_ttfb:e.responseStart-e.requestStart,p_download:e.responseEnd-e.responseStart,p_to_download:r,p_to_connect:e.connectEnd-e.fetchStart,url:e.name})},initPerfObserve:function(){var e=this;if(window.PerformanceObserver){var t=new window.PerformanceObserver(function(t){for(var r=t.getEntriesByType("resource"),n=0;n<r.length;n++){var o=r[n];/log\.waimai\.baidu\.com/.test(o.name)||a.indexOf(o.initiatorType)!=-1&&e.analyzePerfEntry(o)}});t.observe({entryTypes:i})}},getLastEntryByUrl:function(e){var t=null;return n.getEntries().some(function(r){if(r.name==o.resolvePath(e))return t=r,!0}),t},initXhrHook:function(){var e=this;window.XMLHttpRequest&&e.xhrHook(window.XMLHttpRequest),document.addEventListener("DOMContentLoaded",function(t){e.initjQueryAjaxHook(),e.initjQueryObserve()})},initjQueryAjaxHook:function(){(window.jQuery||window.Zepto)&&$(document).ajaxError(function(e,n,o,a){t.report("exception",{tag:"xhr",url:o.url,method:o.type,purl:r.href,err_status:n.status,err_txt:n.statusText})})},xhrHook:function(t){var r=t.prototype.open,n=t.prototype.send,o=this,a="";t.prototype.open=function(e,t){return this._track={method:e.toLowerCase(),url:t},a="xhr_"+ +new Date,r.apply(this,arguments)},t.prototype.send=function(){return this._trackName=a,e[a]=!0,o.registerComplete(this),n.apply(this,arguments)}},registerComplete:function(e){var t=this;e.addEventListener?e.addEventListener("readystatechange",function(){4==e.readyState&&t.checkComplete(e)},!0):setTimeout(function(){var r=e.onload;e.onload=function(){return t.checkComplete(e),r.apply(e,arguments)};var n=e.onerror;e.onerror=function(){return t.checkComplete(e),n.apply(e,arguments)}},0)},checkComplete:function(n){n._track&&(e[n._trackName]&&n.status>=400&&t.report("exception",{tag:"xhr",url:n._track.url,method:n._track.method,purl:r.href,err_status:n.status,err_txt:n.statusText}),delete n._trackName,delete n._track,delete e[n._trackName])}}});var o={resolvePath:function(e){var t=/^(?:[\.]{1,2}\/?)*\/?\w+/,n=/^http(?:s)?:\/\//;if(!t.test(e)||n.test(e))return e;var o=r.href.split("/"),a=e.split("/"),i=0;return/^\.{1,2}$/.test(a[0])?(a.some(function(e){".."==e&&i++}),o=o.slice(0,Math.max(3,o.length-i-1)),o.push(a[a.length-1])):/^\/.+/.test(e)?(o=[r.protocol+"//"+r.host],o.push(e.substr(1))):(o=o.slice(0,o.length-1),o.push(e)),o.join("/")}}}(window),~function(e){var t=e.BDWMMonitor,r=e.location;t("exception",function(){return{run:function(){this.catchException()},catchException:function(){function e(e){var t=e.stack.replace(/\n/gi,"").split(/\bat\b/).slice(0,9).join("@").replace(/\?[^:]+/gi,""),r=e.toString();return t.indexOf(r)<0&&(t=r+"@"+t),t}window.onerror=function(n,o,a,i,c){var u=n;c&&c.stack&&(u=e(c)),t.report("exception",{tag:"js_error",err_txt:u,url:o,purl:r.href,ln:a,col:i,err_status:401})}}}})}(window),function(e){function t(e){var t=o.timing,r=t[e+"Start"]?t[e+"Start"]:0,n=t[e+"End"]?t[e+"End"]:0;return{start:r,end:n,value:0<n-r?n-r:0}}function r(e,t,r){if(e.length===+e.length)for(var n=0;n<e.length;n++)t.call(r,n,e[n],e);else for(var o in e)e.hasOwnProperty(o)&&t.call(r,o,e[o],e)}var n=e.BDWMMonitor,o=e.performance||e.webkitPerformance||e.msPerformance||e.mozPerformance;n("perf",function(){var a={},i={};return{run:function(){this.domHook()},domHook:function(){var e=this;document.onreadystatechange=function(){"complete"===document.readyState&&setTimeout(function(){e.collectPerf()},10)}},collectPerf:function(){o&&(this.collect(),n.report("perf",i))},collect:function(){if(o){var n=o.timing,c=t("navigation"),u=t("request"),s=t("response"),d=t("domainLookup"),p=t("connect"),l=t("loadEvent"),f=(t("unloadEvent"),n.navigationStart);a.p_dns=n.domainLookupEnd,a.p_ct=n.connectEnd,a.p_st=n.responseStart,a.p_tt=n.responseEnd,a.p_dct=n.domComplete,a.p_olt=n.loadEventEnd,r(a,function(e,t){a[e]=Math.max(t-f,0)});var m={p_lookup:d.value,p_tcp:p.value,p_ssl:n.secureConnectionStart>0?n.connectEnd-n.secureConnectionStart:0,p_ttfb:s.start-u.start,p_download:s.value,p_to_download:s.end-c.start,p_to_connect:p.end-c.start,p_dom_ready:n.domComplete-n.domLoading,p_to_dom_ready:n.domComplete-n.navigationStart,p_dom_loaded:l.value,p_to_dom_loaded:l.end-c.start,p_net:u.start-c.start,p_srv:s.end-u.start,p_brw:l.end-n.domLoading};r(a,function(e,t){i[e]=t}),r(m,function(e,t){i[e]=t});var v=["network: "+m.p_net,"server: "+m.p_srv,"browser: "+m.p_brw];e.__perf=v.join("\n")}}}})}(window);